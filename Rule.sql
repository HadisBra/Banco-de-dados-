CREATE TABLE GERENTE(
NOME_GERENTE VARCHAR(50) NOT NULL,
PRIMARY KEY(NOME_GERENTE));
CREATE TABLE EMPREGADO(
NOME_EMPREGADO VARCHAR(50) NOT NULL,
NOME_GERENTE VARCHAR(50) NOT NULL,
RUA VARCHAR(50) NOT NULL,
CIDADE VARCHAR(50) NOT NULL,
CEP VARCHAR(9) NOT NULL,
PRIMARY KEY(NOME_EMPREGADO),
CONSTRAINT FK_GERENTE FOREIGN KEY (NOME_GERENTE)
REFERENCES GERENTE(NOME_GERENTE));
CREATE TABLE COMPANHIA(
NOME_COMPANHIA VARCHAR(50) NOT NULL,
CIDADE VARCHAR(50) NOT NULL,
PRIMARY KEY(NOME_COMPANHIA));
CREATE TABLE TRABALHA(
NOME_EMPREGADO VARCHAR(50) NOT NULL,
NOME_COMPANHIA VARCHAR(50) NOT NULL,
SALARIO FLOAT,
CARGO VARCHAR(50) NOT NULL,
CONSTRAINT PK_TRAPKEY PRIMARY KEY
(NOME_EMPREGADO,NOME_COMPANHIA), CONSTRAINT FK_EMPREGADO FOREIGN
KEY (NOME_EMPREGADO)
REFERENCES EMPREGADO(NOME_EMPREGADO),
CONSTRAINT FK_COMPANHIA FOREIGN KEY (NOME_COMPANHIA)
REFERENCES COMPANHIA(NOME_COMPANHIA));
INSERT INTO GERENTE VALUES ('Sara');
INSERT INTO GERENTE VALUES ('Vitor');
INSERT INTO GERENTE VALUES ('Luciana');
INSERT INTO GERENTE VALUES ('Alberto');
INSERT INTO GERENTE VALUES ('Roberto');
INSERT INTO EMPREGADO VALUES ('Vitor','Sara','308 Sul','Palmas','77016-260');
INSERT INTO EMPREGADO VALUES ('Sara','Alberto','508 Sul','Palmas','77026-060');
INSERT INTO EMPREGADO VALUES ('Luciana','Roberto','603
Norte','Palmas','77078-270');
INSERT INTO EMPREGADO VALUES ('Alberto','Vitor','203 Norte','Palmas','77006-056');
INSERT INTO EMPREGADO VALUES ('Roberto','Luciana','210 Sul','Palmas','77786-048');
INSERT INTO EMPREGADO VALUES ('João','Luciana','603 Norte','Palmas','77996-756');
INSERT INTO EMPREGADO VALUES ('Kamilla','Sara','508 Sul','Palmas','77999-888');
INSERT INTO EMPREGADO VALUES ('Gabriel','Sara','405 Norte','Palmas','7799-456');
INSERT INTO EMPREGADO VALUES ('Pedro','Sara','Av, 12','Porto
Nacional','78099-123');
INSERT INTO COMPANHIA VALUES ('Cinemark','Palmas');
INSERT INTO COMPANHIA VALUES ('Havan','Palmas');
INSERT INTO COMPANHIA VALUES ('Supermercado Extra','Palmas');
INSERT INTO COMPANHIA VALUES ('Banco do Brasil','Palmas');
INSERT INTO COMPANHIA VALUES ('Bradesco','Palmas');
INSERT INTO COMPANHIA VALUES ('Lojas Americanas','Palmas');
INSERT INTO COMPANHIA VALUES ('Supermercado Pão de Açucar','Palmas');
INSERT INTO TRABALHA VALUES ('Vitor','Cinemark',100,'Atendente');
INSERT INTO TRABALHA VALUES ('Sara','Havan',2500,'Vendedora');
INSERT INTO TRABALHA VALUES ('Luciana','Cinemark',2700,'Auxiliador de Gerente');
INSERT INTO TRABALHA VALUES ('Alberto','Banco do Brasil',3000,'Atendente');
INSERT INTO TRABALHA VALUES ('Roberto','Supermercado Extra',2500,'Vendedor');
INSERT INTO TRABALHA VALUES ('João','Havan',4000,'Segurança');
INSERT INTO TRABALHA VALUES ('Kamilla','Cinemark',2000,'Caixa');
INSERT INTO TRABALHA VALUES ('Gabriel','Cinemark',2700,'Fiscal');
INSERT INTO TRABALHA VALUES ('Pedro', 'Lojas Americanas',2700,'Vendedor');



/*
Questa 1
*/

SELECT * from trabalha;

CREATE TABLE EMP_LOG (
nome_empregado varchar(50),
NOVO_SALARIO DECIMAL (10,2),
USUARIO VARCHAR(50),
DATAHORA TIMESTAMP);

CREATE RULE LOG_EMP_RULE AS ON UPDATE TO trabalha
WHERE NEW.salario <> OLD.salario
DO INSERT INTO EMP_LOG
VALUES (NEW.nome_empregado, NEW.salario, CURRENT_USER,
CURRENT_TIMESTAMP);

UPDATE trabalha SET salario=2000 WHERE NOME_EMPREGADO='Vitor';
UPDATE trabalha SET salario=6000 WHERE NOME_EMPREGADO='Alberto';

SELECT * from emp_log;

/*
Questão 2
*/

SELECT * from companhia;

CREATE TABLE EMP_LOG_1 (
nome_companhia varchar(50),
cidade varchar (50),
USUARIO VARCHAR(50),
DATAHORA TIMESTAMP);

CREATE RULE LOG_EMP_RULE_2 AS ON INSERT TO companhia
DO INSERT INTO emp_log_1
VALUES (NEW.nome_companhia, NEW.cidade, CURRENT_USER,
CURRENT_TIMESTAMP);

INSERT into companhia VALUES ('Imperial','Imperatriz');
INSERT into companhia VALUES ('Web','Goiania');
SELECT * from emp_log_1;


/*
questão 3
*/
SELECT * from trabalha;

CREATE TABLE EMP_LOG_2 (
nome_empregado varchar(50),
nome_companhia varchar (50),
USUARIO VARCHAR(50),
DATAHORA TIMESTAMP);

CREATE RULE LOG_EMP_RULE_3 AS ON DELETE TO trabalha
DO INSTEAD
INSERT INTO EMP_LOG_2
VALUES (OLD.nome_empregado, OLD.nome_companhia, CURRENT_USER,
CURRENT_TIMESTAMP);

DELETE FROM trabalha WHERE nome_empregado = 'Vitor';
DELETE FROM trabalha WHERE nome_empregado = 'Alberto';
SELECT * from EMP_LOG_2;

